<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Defender Clone</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: monospace; overflow: hidden; touch-action: none; user-select: none; }
        canvas { display: block; width: 100vw; height: 56.25vw; max-height: 100vh; max-width: 177.78vh; margin: auto; background: #000; border: 1px solid #333; }
        #ui { position: absolute; top: 10px; left: 10px; right: 10px; display: flex; justify-content: space-between; font-size: clamp(14px, 4vw, 18px); pointer-events: none; text-shadow: 2px 2px #000; }
        #controls { position: absolute; bottom: 20px; left: 0; width: 100%; display: flex; justify-content: space-between; padding: 0 20px; box-sizing: border-box; }
        .btn { width: 60px; height: 60px; border: 2px solid #0ff; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: rgba(0,255,255,0.1); color: #0ff; font-weight: bold; font-size: 10px; cursor: pointer; }
        .joystick { width: 120px; height: 120px; border-radius: 50%; border: 1px solid #333; background: rgba(255,255,255,0.05); position: relative; }
        #knob { width: 40px; height: 40px; background: #0ff; border-radius: 50%; position: absolute; left: 40px; top: 40px; box-shadow: 0 0 10px #0ff; pointer-events: none; }
        #start-scr { position: absolute; inset: 0; background: rgba(0,0,0,0.85); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; }
        h1 { color: #0ff; letter-spacing: 5px; margin: 0; font-size: 40px; }
        .play-btn { border: 2px solid #0ff; color: #0ff; padding: 10px 30px; margin-top: 20px; cursor: pointer; font-size: 20px; }
    </style>
</head>
<body>
    <div id="start-scr">
        <h1>DEFENDER</h1>
        <p>Protect the humanoids.</p>
        <div class="play-btn" onclick="startGame()">ENGAGE</div>
    </div>
    <div id="ui">
        <div>SCORE: <span id="s">0</span></div>
        <div>BOMBS: <span id="b">3</span></div>
        <div>SHIPS: <span id="l">3</span></div>
    </div>
    <canvas id="c"></canvas>
    <div id="controls">
        <div class="joystick" id="jz"><div id="knob"></div></div>
        <div style="display:flex; gap:10px; align-items: flex-end;">
            <div class="btn" id="bw">WARP</div>
            <div class="btn" id="bb">BOMB</div>
            <div class="btn" id="bf" style="width:80px; height:80px; font-size:16px;">FIRE</div>
        </div>
    </div>

<script>
    const canvas = document.getElementById('c'), ctx = canvas.getContext('2d');
    const WORLD_WIDTH = 5000, VIEW_WIDTH = 1000, VIEW_HEIGHT = 562, GROUND_LEVEL = 500;
    canvas.width = VIEW_WIDTH; canvas.height = VIEW_HEIGHT;

    let running = false, score = 0, lives = 3, bombs = 3, camX = 0;
    let player = null, enemies = [], bullets = [], stars = [], terrain = [], humanoids = [];
    let keys = {}, input = {jx: 0, jy: 0, f: false};

    class Entity {
        constructor(x, y, w, h, c) { this.x=x; this.y=y; this.w=w; this.h=h; this.c=c; this.vx=0; this.vy=0; this.dead=false; }
        getSX() { 
            let r = this.x - camX; 
            if(r < -WORLD_WIDTH/2) r += WORLD_WIDTH; 
            if(r > WORLD_WIDTH/2) r -= WORLD_WIDTH; 
            return r + VIEW_WIDTH/2; 
        }
        update() { this.x += this.vx; this.y += this.vy; if(this.x<0) this.x+=WORLD_WIDTH; if(this.x>=WORLD_WIDTH) this.x-=WORLD_WIDTH; }
    }

    class Player extends Entity {
        constructor() { super(WORLD_WIDTH/2, VIEW_HEIGHT/2, 35, 12, '#fff'); this.d=1; this.cd=0; }
        update() {
            if(keys['KeyW'] || keys['ArrowUp'] || input.jy < -0.1) this.vy -= 0.5;
            if(keys['KeyS'] || keys['ArrowDown'] || input.jy > 0.1) this.vy += 0.5;
            if(keys['KeyA'] || keys['ArrowLeft'] || input.jx < -0.1) { this.vx -= 0.5; this.d = -1; }
            if(keys['KeyD'] || keys['ArrowRight'] || input.jx > 0.1) { this.vx += 0.5; this.d = 1; }
            this.vx *= 0.95; this.vy *= 0.95; super.update();
            if(this.y < 50) this.y = 50; if(this.y > GROUND_LEVEL-this.h) this.y = GROUND_LEVEL-this.h;
            camX = this.x;
            if(this.cd > 0) this.cd--;
            if((keys['Space'] || input.f) && this.cd === 0) {
                bullets.push(new Bullet(this.x + (this.d===1?this.w:0), this.y+5, this.d));
                this.cd = 12;
            }
        }
        draw() {
            let sx = this.getSX(); ctx.strokeStyle = '#fff'; ctx.lineWidth = 2; ctx.beginPath();
            if(this.d===1) { ctx.moveTo(sx,this.y); ctx.lineTo(sx+30,this.y+6); ctx.lineTo(sx,this.y+12); ctx.lineTo(sx+5,this.y+6); }
            else { ctx.moveTo(sx+30,this.y); ctx.lineTo(sx,this.y+6); ctx.lineTo(sx+30,this.y+12); ctx.lineTo(sx+25,this.y+6); }
            ctx.stroke();
        }
    }

    class Bullet extends Entity {
        constructor(x,y,d) { super(x,y,40,2,'#0ff'); this.vx=d*18; this.l=50; }
        update() { super.update(); this.l--; if(this.l<=0) this.dead=true; }
        draw() { ctx.fillStyle=this.c; ctx.fillRect(this.getSX(), this.y, this.w, this.h); }
    }

    class Enemy extends Entity {
        constructor() { super(Math.random()*WORLD_WIDTH, 50+Math.random()*300, 22, 22, '#f0f'); this.vx=(Math.random()-0.5)*3; this.vy=(Math.random()-0.5)*1.5; }
        update() { super.update(); if(this.y<30 || this.y>GROUND_LEVEL-30) this.vy*=-1; }
        draw() { let sx=this.getSX(); ctx.strokeStyle=this.c; ctx.lineWidth=2; ctx.strokeRect(sx,this.y,this.w,this.h); ctx.strokeRect(sx+6,this.y+6,10,10); }
    }

    function startGame() {
        document.getElementById('start-scr').classList.add('hidden');
        score=0; lives=3; bombs=3; player=new Player(); enemies=[]; bullets=[];
        stars=Array.from({length:100},()=>({x:Math.random()*WORLD_WIDTH, y:Math.random()*GROUND_LEVEL, c:'#666'}));
        terrain=[]; for(let x=0; x<=WORLD_WIDTH; x+=100) terrain.push({x, y:GROUND_LEVEL-Math.random()*100});
        for(let i=0; i<15; i++) enemies.push(new Enemy());
        running=true;
    }

    function loop() {
        if(running && player) {
            player.update();
            bullets.forEach(b=>b.update());
            enemies.forEach(e=>{
                e.update();
                let dx=Math.abs(player.getSX()-e.getSX());
                if(dx<20 && Math.abs(player.y-e.y)<20) { lives--; if(lives<=0) { running=false; document.getElementById('start-scr').classList.remove('hidden'); } else { player.x=WORLD_WIDTH/2; player.y=VIEW_HEIGHT/2; } }
            });
            bullets.forEach(b=>{
                enemies.forEach(e=>{
                    let dx=Math.abs(b.getSX()-e.getSX());
                    if(dx<e.w && Math.abs(b.y-e.y)<e.h) { e.dead=true; b.dead=true; score+=150; }
                });
            });
            enemies=enemies.filter(e=>!e.dead); bullets=bullets.filter(b=>!b.dead);
            if(enemies.length<8) enemies.push(new Enemy());
            document.getElementById('s').innerText=score; document.getElementById('b').innerText=bombs; document.getElementById('l').innerText=lives;
        }
        ctx.fillStyle='#000'; ctx.fillRect(0,0,VIEW_WIDTH,VIEW_HEIGHT);
        if(player) {
            stars.forEach(s=>{ let sx=s.x-camX; if(sx<-WORLD_WIDTH/2)sx+=WORLD_WIDTH; if(sx>WORLD_WIDTH/2)sx-=WORLD_WIDTH; ctx.fillStyle=s.c; ctx.fillRect(sx+VIEW_WIDTH/2,s.y,1,1); });
            ctx.strokeStyle='#a52a2a'; ctx.beginPath(); terrain.forEach((p,i)=>{
                let sx=p.x-camX; if(sx<-WORLD_WIDTH/2)sx+=WORLD_WIDTH; if(sx>WORLD_WIDTH/2)sx-=WORLD_WIDTH; if(i===0)ctx.moveTo(sx+VIEW_WIDTH/2,p.y); else ctx.lineTo(sx+VIEW_WIDTH/2,p.y);
            }); ctx.stroke();
            bullets.forEach(b=>b.draw()); enemies.forEach(e=>e.draw()); player.draw();
            drawRadar();
        }
        requestAnimationFrame(loop);
    }

    function drawRadar() {
        const rw=600, rh=50, rx=(VIEW_WIDTH-rw)/2, ry=15, scale=rw/WORLD_WIDTH;
        ctx.fillStyle='rgba(30,30,30,0.8)'; ctx.fillRect(rx,ry,rw,rh);
        ctx.fillStyle='#fff'; ctx.fillRect(rx+player.x*scale, ry+player.y/VIEW_HEIGHT*rh, 3, 3);
        ctx.fillStyle='#f0f'; enemies.forEach(e=>ctx.fillRect(rx+e.x*scale, ry+e.y/VIEW_HEIGHT*rh, 2, 2));
    }

    window.addEventListener('keydown', e=>keys[e.code]=true);
    window.addEventListener('keyup', e=>keys[e.code]=false);
    
    const knob=document.getElementById('knob'), jz=document.getElementById('jz');
    let tj=false;
    jz.addEventListener('pointerdown', ()=>tj=true);
    window.addEventListener('pointermove', e=>{
        if(!tj)return; const r=jz.getBoundingClientRect(), dx=e.clientX-(r.left+60), dy=e.clientY-(r.top+60), dist=Math.min(60, Math.sqrt(dx*dx+dy*dy));
        knob.style.transform=`translate(${dx*dist/60}px,${dy*dist/60}px)`;
        input.jx=dx/60; input.jy=dy/60;
    });
    window.addEventListener('pointerup', ()=>{tj=false; knob.style.transform=''; input.jx=0; input.jy=0;});
    document.getElementById('bf').addEventListener('pointerdown', ()=>input.f=true);
    document.getElementById('bf').addEventListener('pointerup', ()=>input.f=false);
    document.getElementById('bb').addEventListener('pointerdown', ()=>{ if(bombs>0){bombs--; enemies.forEach(e=>{if(Math.abs(e.getSX()-VIEW_WIDTH/2)<VIEW_WIDTH/2)e.dead=true;});}});
    document.getElementById('bw').addEventListener('pointerdown', ()=>{player.x=Math.random()*WORLD_WIDTH; player.y=Math.random()*GROUND_LEVEL;});

    loop();
</script>
</body>
</html>
