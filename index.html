<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trons Games</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Handlee&display=swap');

        body {
            font-family: 'Handlee', cursive;
            background-color: #0f172a;
            color: #e2e8f0;
            overflow: hidden;
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        nav {
            background-color: #1e293b;
            border-bottom: 2px solid #334155;
            padding: 0.5rem 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 1000;
        }

        .nav-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: all 0.2s;
            font-weight: bold;
            cursor: pointer;
            user-select: none;
        }

        .nav-btn.active {
            background-color: #4f46e5;
            color: white;
        }

        .nav-btn:not(.active):hover {
            background-color: #334155;
        }

        .game-container {
            flex-grow: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: auto;
            width: 100%;
            height: 100%;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Cootie Catcher UI */
        .scene { perspective: 1000px; width: 300px; height: 300px; position: relative; }
        .catcher { width: 100%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 0.5s ease; }
        .flap {
            position: absolute; width: 150px; height: 150px; background: #1e293b; border: 2px solid #334155;
            transform-origin: center; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), background 0.3s;
            user-select: none; box-shadow: inset 0 0 15px rgba(0,0,0,0.3);
        }
        .top-left { top: 0; left: 0; border-radius: 10px 0 0 0; }
        .top-right { top: 0; left: 150px; border-radius: 0 10px 0 0; }
        .bottom-left { top: 150px; left: 0; border-radius: 0 0 0 10px; }
        .bottom-right { top: 150px; left: 150px; border-radius: 0 0 10px 0; }
        .catcher.open-h .top-left { transform: rotateY(-40deg) translateX(-10px); }
        .catcher.open-h .top-right { transform: rotateY(40deg) translateX(10px); }
        .catcher.open-h .bottom-left { transform: rotateY(-40deg) translateX(-10px); }
        .catcher.open-h .bottom-right { transform: rotateY(40deg) translateX(10px); }
        .catcher.open-v .top-left { transform: rotateX(40deg) translateY(-10px); }
        .catcher.open-v .top-right { transform: rotateX(40deg) translateY(-10px); }
        .catcher.open-v .bottom-left { transform: rotateX(-40deg) translateY(10px); }
        .catcher.open-v .bottom-right { transform: rotateX(-40deg) translateY(10px); }

        .hidden-fortune {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: #1e293b; padding: 2rem; border-radius: 1rem; z-index: 100; max-width: 80%;
            border: 4px dashed #818cf8; text-align: center;
        }
        .dot-pulse { animation: dotPulse 1.5s infinite linear; }
        @keyframes dotPulse { 0% { opacity: 0.2; } 50% { opacity: 1; } 100% { opacity: 0.2; } }
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <nav>
        <div class="flex items-center gap-4">
            <span class="text-xl font-bold text-indigo-400 mr-4">Trons Games</span>
            <div id="nav-tabs" class="flex gap-2">
                <!-- Tabs will be injected here -->
            </div>
        </div>
    </nav>

    <div id="game-viewport" class="flex-grow relative flex w-full">
        <!-- Game sections will be injected here -->
    </div>

    <!-- Cootie Catcher Template (Hidden until active) -->
    <template id="cootie-template">
        <div class="game-container">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-indigo-400 mb-2">Cootie Catcher</h1>
                <p id="instruction" class="text-lg text-indigo-300 font-medium">Pick a Color!</p>
            </div>
            <div class="scene">
                <div id="catcher" class="catcher">
                    <div class="flap top-left" onclick="handleChoice('tl')"><div id="content-tl" class="w-full h-full flex items-center justify-center font-bold text-lg"></div></div>
                    <div class="flap top-right" onclick="handleChoice('tr')"><div id="content-tr" class="w-full h-full flex items-center justify-center font-bold text-lg"></div></div>
                    <div class="flap bottom-left" onclick="handleChoice('bl')"><div id="content-bl" class="w-full h-full flex items-center justify-center font-bold text-lg"></div></div>
                    <div class="flap bottom-right" onclick="handleChoice('br')"><div id="content-br" class="w-full h-full flex items-center justify-center font-bold text-lg"></div></div>
                </div>
            </div>
            <div id="fortune-modal" class="hidden-fortune">
                <h2 class="text-2xl font-bold text-indigo-300 mb-4">Your Fortune:</h2>
                <div id="loading-spinner" class="mb-6 hidden">
                    <p class="text-indigo-400 italic">Consulting the magic spirits...</p>
                    <div class="flex justify-center gap-2 mt-2">
                        <div class="w-3 h-3 bg-indigo-400 rounded-full dot-pulse"></div>
                        <div class="w-3 h-3 bg-indigo-400 rounded-full dot-pulse" style="animation-delay: 0.2s"></div>
                        <div class="w-3 h-3 bg-indigo-400 rounded-full dot-pulse" style="animation-delay: 0.4s"></div>
                    </div>
                </div>
                <p id="fortune-text" class="text-2xl italic text-slate-100 mb-6"></p>
                <button onclick="resetGame()" class="bg-indigo-600 text-white px-6 py-2 rounded-full hover:bg-indigo-500 transition shadow-lg">Play Again</button>
            </div>
            <div class="mt-8 h-8"><div id="counter" class="text-3xl font-bold text-indigo-400"></div></div>
            <div class="mt-4 flex items-center gap-2 bg-slate-800 px-4 py-2 rounded-full shadow-md border border-slate-700">
                <span class="text-indigo-300 font-medium text-sm">Magic AI Mode</span>
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="gemini-toggle" class="sr-only peer" checked>
                    <div class="w-9 h-5 bg-slate-600 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-indigo-500"></div>
                </label>
            </div>
        </div>
    </template>

    <script>
        // --- ADD NEW GAMES HERE ---
        const games = [
            { id: 'wordle', title: 'Wordle', type: 'iframe', url: 'https://tronsguitar.github.io/Wordle-Clone/' },
            { id: 'cootie', title: 'Cootie Catcher', type: 'internal' }
        ];

        const apiKey = ""; 
        const modelName = "gemini-2.5-flash-preview-09-2025";
        let currentTab = '';

        function setupApp() {
            const tabsContainer = document.getElementById('nav-tabs');
            const viewport = document.getElementById('game-viewport');

            games.forEach((game, index) => {
                // Create Tab
                const tab = document.createElement('div');
                tab.id = `tab-${game.id}`;
                tab.className = `nav-btn ${index === 0 ? 'active' : ''}`;
                tab.innerText = game.title;
                tab.onclick = () => switchTab(game.id);
                tabsContainer.appendChild(tab);

                // Create Content Section
                const section = document.createElement('div');
                section.id = `section-${game.id}`;
                section.className = `game-container ${index === 0 ? '' : 'hidden'}`;
                
                if (game.type === 'iframe') {
                    const ifr = document.createElement('iframe');
                    ifr.src = game.url;
                    section.appendChild(ifr);
                } else if (game.id === 'cootie') {
                    const temp = document.getElementById('cootie-template');
                    section.appendChild(temp.content.cloneNode(true));
                }
                
                viewport.appendChild(section);
            });

            currentTab = games[0].id;
            if (currentTab === 'cootie') initColors();
        }

        function switchTab(gameId) {
            games.forEach(g => {
                document.getElementById(`section-${g.id}`).classList.toggle('hidden', g.id !== gameId);
                document.getElementById(`tab-${g.id}`).classList.toggle('active', g.id === gameId);
            });
            currentTab = gameId;
            if (gameId === 'cootie') initColors();
        }

        // --- Cootie Catcher Shared Logic ---
        let gameState = 'COLORS';
        let isAnimating = false;
        let selections = { color: '', num1: null, num2: null };
        const fortunes = ["Lucky penny day!", "Backyard adventure!", "New friend soon!", "Lunchbox surprise!", "Kindness rewarded!", "Secret admirer!", "Test success!", "Famous explorer!"];

        function getCootieEl(id) { return document.getElementById(`section-cootie`).querySelector(`#${id}`); }

        function initColors() {
            gameState = 'COLORS';
            getCootieEl('instruction').innerText = "Pick a Color!";
            getCootieEl('counter').innerText = "";
            selections = { color: '', num1: null, num2: null };
            const configs = [
                { id: 'tl', label: 'RED', bg: '#991b1b', text: '#fecaca' },
                { id: 'tr', label: 'BLUE', bg: '#1e3a8a', text: '#bfdbfe' },
                { id: 'bl', label: 'GREEN', bg: '#064e3b', text: '#bbf7d0' },
                { id: 'br', label: 'YELLOW', bg: '#713f12', text: '#fef08a' }
            ];
            configs.forEach(c => {
                const el = getCootieEl(`content-${c.id}`);
                el.innerText = c.label;
                el.parentElement.style.backgroundColor = c.bg;
                el.style.color = c.text;
            });
        }

        function showNumbers(set) {
            const nums = set === 1 ? [1, 2, 5, 6] : [3, 4, 7, 8];
            ['tl', 'tr', 'bl', 'br'].forEach((id, i) => {
                const el = getCootieEl(`content-${id}`);
                el.innerText = nums[i];
                el.style.color = '#a5b4fc';
                el.parentElement.style.backgroundColor = '#1e293b';
            });
        }

        async function animateCatcher(count) {
            isAnimating = true;
            const cat = getCootieEl('catcher');
            const countEl = getCootieEl('counter');
            for (let i = 0; i < count; i++) {
                countEl.innerText = i + 1;
                cat.className = (i % 2 === 0) ? 'catcher open-v' : 'catcher open-h';
                await new Promise(r => setTimeout(r, 400));
                cat.className = 'catcher';
                await new Promise(r => setTimeout(r, 100));
            }
            countEl.innerText = "";
            isAnimating = false;
        }

        async function handleChoice(idSuffix) {
            if (isAnimating || gameState === 'REVEAL' || currentTab !== 'cootie') return;
            const choice = getCootieEl('content-' + idSuffix).innerText;
            if (gameState === 'COLORS') {
                selections.color = choice;
                await animateCatcher(choice.length);
                gameState = 'NUMBER_1';
                getCootieEl('instruction').innerText = "Pick a Number!";
                showNumbers(1);
            } else if (gameState === 'NUMBER_1') {
                selections.num1 = choice;
                await animateCatcher(parseInt(choice));
                gameState = 'NUMBER_2';
                getCootieEl('instruction').innerText = "Pick one last Number!";
                showNumbers(2);
            } else if (gameState === 'NUMBER_2') {
                selections.num2 = choice;
                revealFortune();
            }
        }

        async function revealFortune() {
            gameState = 'REVEAL';
            getCootieEl('instruction').innerText = "The future is revealed!";
            const fText = getCootieEl('fortune-text');
            fText.innerText = "";
            getCootieEl('fortune-modal').style.display = 'block';

            if (getCootieEl('gemini-toggle').checked) {
                getCootieEl('loading-spinner').classList.remove('hidden');
                const aiFortune = await generateGeminiFortune(selections);
                getCootieEl('loading-spinner').classList.add('hidden');
                fText.innerText = aiFortune;
            } else {
                fText.innerText = fortunes[Math.floor(Math.random() * fortunes.length)];
            }
        }

        async function generateGeminiFortune(data) {
            const systemPrompt = "Playful magic fortune teller. One short whimsy sentence fortune for a child. Output only text.";
            const userQuery = `Choices: Color ${data.color}, Nums ${data.num1}, ${data.num2}. Fortune!`;
            let retries = 0;
            while (retries <= 5) {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ contents: [{ parts: [{ text: userQuery }] }], systemInstruction: { parts: [{ text: systemPrompt }] } })
                    });
                    const result = await response.json();
                    return result.candidates?.[0]?.content?.parts?.[0]?.text || "Joy is coming!";
                } catch {
                    await new Promise(r => setTimeout(r, Math.pow(2, retries) * 1000));
                    retries++;
                }
            }
            return "Spirits are shy today!";
        }

        function resetGame() {
            getCootieEl('fortune-modal').style.display = 'none';
            getCootieEl('catcher').className = 'catcher';
            initColors();
        }

        window.onload = setupApp;
    </script>
</body>
</html>
